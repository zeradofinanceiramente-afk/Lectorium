
@tailwind base;
@tailwind components;
@tailwind utilities;

/* RESET TAP HIGHLIGHT */
* {
  -webkit-tap-highlight-color: transparent;
}

/* Standalone / Native Adjustments */
:root {
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
}

.standalone-container {
  padding-top: var(--safe-top);
  padding-left: var(--safe-left);
  padding-right: var(--safe-right);
  background-color: var(--bg-main);
}

.standalone-safe-bottom {
  padding-bottom: var(--safe-bottom);
}

.top-safe {
  top: calc(var(--safe-top) + 0.5rem);
}

.top-safe-plus {
  top: calc(var(--safe-top) + 1rem);
}

body.is-native {
  user-select: none;
  overflow: hidden;
  height: 100dvh;
}

/* Permitir seleção apenas no editor */
body.is-native .ProseMirror,
body.is-native input,
body.is-native textarea {
  user-select: text;
}

/* --- CHROMIUM OPTIMIZATIONS --- */
.chromium-virtual-render {
  content-visibility: auto;
  contain-intrinsic-size: auto 1100px; 
}

.gpu-layer {
  will-change: transform;
  transform: translateZ(0);
}

/* --- THEME DEFINITIONS --- */
/* Default (OLED / True Black Protocol) */
:root {
  --bg-main: #000000; /* Mudança Tática: Zero Energy */
  --bg-surface: #0a0a0a;
  --bg-sidebar: #000000;
  --bg-paper: #000000;
  --text-main: #e2e8f0;
  --text-sec: #a1a1aa;
  --border-color: #27272a;
  
  /* Gradient System: Forest -> Emerald */
  --brand: #4ade80;
  --brand-to: #34d399; 
}

/* Base High Contrast / Amoled Structure */
html.azul,
html.vermelho,
html.laranja,
html.amarelo,
html.lima,
html.roxo,
html.rosa,
html.magenta,
html.prata,
html.custom {
  --bg-main: #000000;
  --bg-surface: #000000;
  --bg-sidebar: #000000;
  --bg-paper: #000000;
  --text-main: #ffffff;
  --text-sec: #ffffff;
  --border-color: #ffffff;
}

/* Specific Brands & Gradients - REFINED TACTICAL PALETTE */

/* Azul: Tech Blue (Interstellar) */
html.azul { --brand: #3b82f6; --brand-to: #60a5fa; }

/* Vermelho: Fiery (Mantido Original) */
html.vermelho { --brand: #FF0000; --brand-to: #fb923c; }

/* Laranja: Safety Orange (Industrial) */
html.laranja { --brand: #f97316; --brand-to: #fb923c; }

/* Amarelo: Warning (Hazard) */
html.amarelo { --brand: #eab308; --brand-to: #facc15; }

/* Lima: Bio (Toxic) */
html.lima { --brand: #84cc16; --brand-to: #a3e635; }

/* Roxo: Void (Deep Space) */
html.roxo { --brand: #8b5cf6; --brand-to: #a78bfa; }

/* Rosa: Mantido Original */
html.rosa { --brand: #FF0080; --brand-to: #a855f7; }

/* Magenta: Pure Magenta (Corrigido: Removeu o roxo) */
html.magenta { --brand: #ff00ff; --brand-to: #e000cc; }

/* Prata: Titanium (Mech) */
html.prata { --brand: #94a3b8; --brand-to: #cbd5e1; }

/* Custom Theme Variable Injection handled by React */
html.custom { 
  --brand: var(--custom-brand, #ffffff);
  /* Custom themes fade to same color or white for safety */
  --brand-to: var(--custom-brand, #ffffff);
}

/* --- TIPTAP & TEXT LAYER STYLES --- */
.ProseMirror {
  outline: none;
  font-size: 1.125rem;
  line-height: 1.75;
  box-sizing: border-box; 
  width: 100%;
  max-width: 100%;
  overflow-wrap: break-word;
  word-wrap: break-word;
  word-break: break-word;
  white-space: pre-wrap;
  caret-color: #f97316 !important;
  background-color: transparent !important; 
}

/* Melhoria Crítica: Seleção Visível para OCR */
::selection {
  background-color: rgba(74, 222, 128, 0.4) !important;
  color: inherit !important;
}

.textLayer {
  opacity: 1;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  line-height: 1;
  text-rendering: geometricPrecision;
  /* PERFORMANCE CRITICAL: Isolamento de renderização para milhares de spans */
  /* 'strict' remove a camada do fluxo de layout global, evitando recálculos pesados */
  contain: strict; 
  
  /* FIXED: Desativa seleção nativa no container */
  user-select: none;
  -webkit-user-select: none;
  /* O container ignora cliques, apenas filhos respondem */
  pointer-events: none !important;
}

/* Estilo para spans de OCR e Texto */
.textLayer span, .ocr-word-span {
  color: transparent;
  position: absolute;
  white-space: pre;
  /* FIXED: Cursor pointer para indicar interatividade customizada */
  cursor: pointer;
  transform-origin: 0% 0%;
  
  /* CRITICAL FIX: Desativa seleção nativa (Remove Gotículas/Azul) */
  /* Mantemos pointer-events auto para que o JS detecte o clique */
  user-select: none;
  -webkit-user-select: none;
  pointer-events: auto !important;
}

/* SMART SELECTOR ANCHOR (Tap-to-Select) */
.textLayer span.selection-anchor {
  /* Âncora Estática com destaque sutil */
  background-color: rgba(74, 222, 128, 0.2);
  border-bottom: 2px solid var(--brand);
  border-radius: 2px;
  z-index: 100;
  position: absolute; /* Mantém position absolute do span original */
}

/* Emoji de Âncora flutuante (Estático) */
.textLayer span.selection-anchor::after {
  content: "⚓";
  position: absolute;
  top: -1.2em; /* Posiciona acima do texto */
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.8em;
  line-height: 1;
  pointer-events: none;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.ProseMirror-selectednode {
  outline: 2px solid var(--brand) !important;
  border-radius: 2px;
}

/* TABLE STYLES */
.ProseMirror table {
  border-collapse: collapse;
  table-layout: fixed;
  width: 100%;
  margin: 0;
  overflow: hidden;
  border: 1px solid #000000 !important;
}

.ProseMirror table td,
.ProseMirror table th {
  min-width: 1em;
  border: 1px solid #000000 !important;
  padding: 3px 5px;
  vertical-align: top;
  box-sizing: border-box;
  position: relative;
  color: #000000 !important;
}

.ProseMirror table .selectedCell:after {
  z-index: 2;
  position: absolute;
  content: "";
  left: 0; right: 0; top: 0; bottom: 0;
  background: rgba(200, 200, 255, 0.4);
  pointer-events: none;
}

/* SCROLLBARS */
.custom-scrollbar {
  scrollbar-width: thin; 
  scrollbar-color: var(--border-color) transparent; 
}

.custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
.custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
.custom-scrollbar::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
.custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--text-sec); }

@media print {
  @page { margin: 0; size: auto; }
  body, #root, main { background: white !important; color: black !important; height: auto !important; width: 100% !important; overflow: visible !important; display: block !important; position: static !important; }
  .no-print, nav, aside, header, footer, .sidebar, .toolbar, button { display: none !important; }
  .pagination-gap-widget { height: 0 !important; margin: 0 !important; page-break-before: always !important; break-before: page !important; display: block !important; visibility: hidden; }
  .ProseMirror { min-height: 0 !important; padding: 0 !important; color: black !important; background: white !important; }
  ::-webkit-scrollbar { display: none; }
}
