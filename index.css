@tailwind base;
@tailwind components;
@tailwind utilities;

/* RESET TAP HIGHLIGHT */
* {
  -webkit-tap-highlight-color: transparent;
}

/* Standalone / Native Adjustments */
:root {
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
}

.standalone-container {
  padding-top: var(--safe-top);
  padding-left: var(--safe-left);
  padding-right: var(--safe-right);
  background-color: var(--bg-main);
}

.standalone-safe-bottom {
  padding-bottom: var(--safe-bottom);
}

.top-safe {
  top: calc(var(--safe-top) + 0.5rem);
}

.top-safe-plus {
  top: calc(var(--safe-top) + 1rem);
}

body.is-native {
  user-select: none;
  overflow: hidden;
  height: 100dvh;
}

/* Permitir seleção apenas no editor */
body.is-native .ProseMirror,
body.is-native .textLayer span,
body.is-native input,
body.is-native textarea {
  user-select: text;
}

/* --- CHROMIUM OPTIMIZATIONS --- */
.chromium-virtual-render {
  content-visibility: auto;
  contain-intrinsic-size: auto 1100px; 
}

.gpu-layer {
  will-change: transform;
  transform: translateZ(0);
}

/* --- THEME DEFINITIONS --- */
/* Default (OLED / True Black Protocol) */
:root {
  --bg-main: #000000; /* Mudança Tática: Zero Energy */
  --bg-surface: #0a0a0a;
  --bg-sidebar: #000000;
  --bg-paper: #000000;
  --text-main: #e2e8f0;
  --text-sec: #a1a1aa;
  --border-color: #27272a;
  
  /* Gradient System: Forest -> Emerald */
  --brand: #4ade80;
  --brand-to: #34d399; 
}

/* Base High Contrast / Amoled Structure */
html.azul,
html.vermelho,
html.laranja,
html.amarelo,
html.lima,
html.ciano,
html.roxo,
html.rosa,
html.magenta,
html.dourado,
html.prata,
html.custom {
  --bg-main: #000000;
  --bg-surface: #000000;
  --bg-sidebar: #000000;
  --bg-paper: #000000;
  --text-main: #ffffff;
  --text-sec: #ffffff;
  --border-color: #ffffff;
}

/* Specific Brands & Gradients */
/* Azul -> Cyan */
html.azul { --brand: #009DFF; --brand-to: #22d3ee; }

/* Vermelho -> Laranja (Fiery) */
html.vermelho { --brand: #FF0000; --brand-to: #fb923c; }

/* Laranja -> Amarelo */
html.laranja { --brand: #FF8800; --brand-to: #facc15; }

/* Amarelo -> Laranja */
html.amarelo { --brand: #FFFF00; --brand-to: #fb923c; }

/* Lima -> Verde */
html.lima { --brand: #CCFF00; --brand-to: #4ade80; }

/* Ciano -> Azul */
html.ciano { --brand: #00FFFF; --brand-to: #3b82f6; }

/* Roxo -> Fuchsia */
html.roxo { --brand: #BF5AF2; --brand-to: #e879f9; }

/* Rosa -> Roxo */
html.rosa { --brand: #FF0080; --brand-to: #a855f7; }

/* Magenta -> Violeta */
html.magenta { --brand: #FF00FF; --brand-to: #9333ea; }

/* Dourado -> Laranja */
html.dourado { --brand: #FFD700; --brand-to: #fb923c; }

/* Prata -> Branco */
html.prata { --brand: #E0E0E0; --brand-to: #ffffff; }

/* Custom Theme Variable Injection handled by React */
html.custom { 
  --brand: var(--custom-brand, #ffffff);
  /* Custom themes fade to same color or white for safety */
  --brand-to: var(--custom-brand, #ffffff);
}

/* --- TIPTAP & TEXT LAYER STYLES --- */
.ProseMirror {
  outline: none;
  font-size: 1.125rem;
  line-height: 1.75;
  box-sizing: border-box; 
  width: 100%;
  max-width: 100%;
  overflow-wrap: break-word;
  word-wrap: break-word;
  word-break: break-word;
  white-space: pre-wrap;
  caret-color: #f97316 !important;
  background-color: transparent !important; 
}

/* Melhoria Crítica: Seleção Visível para OCR */
::selection {
  background-color: rgba(74, 222, 128, 0.4) !important;
  color: inherit !important;
}

.textLayer {
  opacity: 1;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  line-height: 1;
  text-rendering: geometricPrecision;
  /* PERFORMANCE CRITICAL: Isolamento de renderização para milhares de spans */
  /* 'strict' remove a camada do fluxo de layout global, evitando recálculos pesados */
  contain: strict; 
  /* SELECTOR FIX: Impede que o contêiner vazio seja selecionado, forçando a seleção nos filhos */
  user-select: none;
  -webkit-user-select: none;
  /* INTERACTION FIX: O container ignora cliques, apenas os filhos (texto) respondem. 
     Isso impede que o navegador selecione a página toda ao clicar no vazio. */
  pointer-events: none !important;
}

/* Estilo para spans de OCR */
.textLayer span, .ocr-word-span {
  color: transparent;
  position: absolute;
  white-space: pre;
  cursor: text;
  transform-origin: 0% 0%;
  /* SELECTOR FIX: Reabilita seleção apenas no texto real */
  user-select: text;
  -webkit-user-select: text;
  /* INTERACTION FIX: Reabilita eventos de ponteiro no texto */
  pointer-events: auto !important;
}

/* Forçar destaque azul da seleção mesmo em texto transparente */
.textLayer ::selection {
  background: rgba(0, 120, 215, 0.3) !important;
  color: transparent !important;
}

.ProseMirror-selectednode {
  outline: 2px solid var(--brand) !important;
  border-radius: 2px;
}

/* TABLE STYLES */
.ProseMirror table {
  border-collapse: collapse;
  table-layout: fixed;
  width: 100%;
  margin: 0;
  overflow: hidden;
  border: 1px solid #000000 !important;
}

.ProseMirror table td,
.ProseMirror table th {
  min-width: 1em;
  border: 1px solid #000000 !important;
  padding: 3px 5px;
  vertical-align: top;
  box-sizing: border-box;
  position: relative;
  color: #000000 !important;
}

.ProseMirror table .selectedCell:after {
  z-index: 2;
  position: absolute;
  content: "";
  left: 0; right: 0; top: 0; bottom: 0;
  background: rgba(200, 200, 255, 0.4);
  pointer-events: none;
}

/* SCROLLBARS */
.custom-scrollbar {
  scrollbar-width: thin; 
  scrollbar-color: var(--border-color) transparent; 
}

.custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
.custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
.custom-scrollbar::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
.custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--text-sec); }

@media print {
  @page { margin: 0; size: auto; }
  body, #root, main { background: white !important; color: black !important; height: auto !important; width: 100% !important; overflow: visible !important; display: block !important; position: static !important; }
  .no-print, nav, aside, header, footer, .sidebar, .toolbar, button { display: none !important; }
  .pagination-gap-widget { height: 0 !important; margin: 0 !important; page-break-before: always !important; break-before: page !important; display: block !important; visibility: hidden; }
  .ProseMirror { min-height: 0 !important; padding: 0 !important; color: black !important; background: white !important; }
  ::-webkit-scrollbar { display: none; }
}